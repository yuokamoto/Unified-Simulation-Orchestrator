# 1. プロジェクトコンセプトと全体像

## 目的
**Unified Simulation Orchestrator (USO)** は、  
**複数種類のシミュレーションエンジン（SimPy, Gazebo, Mujoco, Genesis, Isaac Sim, Unreal Engineなど）を切り替え・連携しながら、  
資産（アセット、ロジック、シナリオ）を最大限再利用できる統合シミュレーションフレームワーク** を提供する。

主な目的は以下の通り：
- **大規模かつスケーラブルなシナリオ**（倉庫、工場、ロボティクス）を軽量ロジックシミュレーションで効率的に検証。
- **高精度な物理シミュレーションや3Dビジュアライゼーション**を必要に応じて統合。
- **共通フォーマット（OpenUSD, URDF/SDF, Behavior Tree XML, YAMLスナップショット）**を活用し、複数エンジン間でアセット・ロジック・シナリオを共有。
- **シングルモードと分散モードの両対応**で、小規模テストから数千エージェントの大規模実験までシームレスに対応。
- **既存シミュレータの使用感の維持**を目標とする。シングルモードでを使用する際には、そのシミュレーターの使用感・使用方法を可能な限り維持し、変更点は最小限になるように実装する。例えば、Gazeboの場合、本シミュレーションフレームワークを使用する際も、roslaunchで起動で、追加のnodeやプロセスを何点か起動するだけで、実行可能とする。

## 背景
ロボット開発においては、様々な用途でシミュレーションが活用されるが、それぞれの用途でシミュレータに求められる要求が異なる。代表的なものを以下に示す。
| ユーザー                | 要件                              | 推奨シミュレーター                                                                                                |
| ------------------- | ------------------------------- | -------------------------------------------------------------------------------------------------------- |
| **Navigation・Robot Arm エンジニア** | 高精度な物理・センサーモデル（LiDAR、IMU等）・衝突判定 | **Isaac Sim**, **Gazebo (Ignition)**, **Webots**, **Mujoco**                                             |
| **マルチロボット開発エンジニア**  | 軽量でスケーラブルなマルチエージェント対応、分散実行、物理などの不要な処理のスキップ     | **SimPy**, 　**Stage**, **Flatland**, **ROS 2 + custom simulator**,                     |
| **MLチーム**       | 高品質な3Dレンダリング、カメラ画像生成、合成データ対応    | **Unreal Engine **, **Unity**, **NVIDIA Omniverse** |
| **セールス・コンサルティング**       | 顧客ごとの導入シミュレーション、非エンジニアでも使用可能なUX、様々な外部機器・既存オペレーションとの統合、軽量でスケーラブルなマルチエージェント対応    | **FlexSim** |
| **マーケティング**       | 高品質な3Dレンダリング、ロボットや貨物の移動など製品導入時のイメージ   | **Unreal Engine **, **Unity**, **NVIDIA Omniverse** |

ユーザーの目的（物理シミュレーション・スケーラビリティ・ビジュアルなど）に応じて、最適なシミュレーターは異なり、1つのシミュレーターですべてを高次元で満たすものは存在せず、ユーザーや製品開発のステップにあわせて違うツールを使い分けるか、適切でないシミュレータを無理やり使っているケースがある。

また、複数シミュレータを使い分けるに当たって、同じロジックやアセットを各シミュレータごとに作り直す必要が生じる。

さらに、新しいシミュレータを新規で開発したとしても、すでにあるシミュレータを代替するには、
- 各ユーザーが使い方を習得する
- 既存のシミュレーションツールを作り直す必要が生じる、
  
などの作業が必要となり、現在のチームメンバーから反発を受けツールの以降が難しいことも多い。

そこで、一つのシミュレータで全てを満たすのが難しいため、複数のシミュレータを切り替えて使用でき、可能な限りロジックやアセットを再利用できるシミュレーションフレームワークを提案する。さらに、このフレームワークに置いては、既存のシミュレータとなるべく使用感が同じようになるように実装することで、既存のユーザーが最小限の負担でツールを使用できる、既存のシミュレーションツールをそのまま再利用する、ことも目的とする


## 核心コンセプト
1. **マルチエンジン対応と切替性**  
   - 軽量なロジック中心のイベント駆動型検証には **SimPy**。  
   - 高精度な物理やROS2統合には **Gazebo, Mujoco, Genesis**。  
   - 高品質な3Dレンダリングやマーケティングデモ、MLデータ生成には **Isaac Sim, Unreal Engine**。
   - **シナリオやロジックを共通管理し、必要に応じてシミュレーションエンジンを切替可能**。

2. **資産とロジックの再利用性**  
   - **OpenUSD** で3Dモデルを共通化し、全レンダリング系ツールで使用可能。
   - **URDF/SDF** でロボットの物理的構造を記述し、Gazeboや他エンジンでも共通利用。
   - **共通Behavior Tree (SCXML/BT XML)** を使い、SimPy, Gazebo, Unreal などで同一ロジックを実行。

3. **スナップショット中心の状態管理**  
   - 世界の状態を **フルスナップショット** と **差分スナップショット** で表現し、  
     初期化・同期・バグ再現・リプレイのすべてを統一的に扱う。

4. **柔軟な運用モード**  
   - **シングルモード**: 単一PCでの高速デバッグや小規模テスト向け。
   - **分散モード**: 複数サーバーでの大規模シミュレーション、フォールトトレランス、スケーラビリティを実現。
