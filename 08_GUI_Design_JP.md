# 8. GUI設計（Web + Electron ベース）

## 目的
GUIは、シミュレーションの可視化、シナリオ編集、リプレイ、デバッグを支援する統合ツールとして機能する。  
**Webベース（React + Three.js/Babylon.js）**を基本とし、ブラウザからアクセス。


---

## 通信アーキテクチャ

### 通信プロトコルの役割分担

- **フロントエンド（GUI ⇔ Webサーバー/Simulation Master）**  
  - **WebSocketまたはgRPC-Web**を採用。  
  - WebサーバーがZeroMQと連携し、バックエンドからのスナップショットやイベントを中継。

---

## 構成

### 技術スタック候補
- **フロントエンド**: React（UI）＋ Three.js（3D表示）
- **バックエンド**: Node.jsまたはPythonで構築されたWebサーバー  
  - WebSocket/gRPC-Webサーバーとして機能  

---

## 機能モジュール

### 1. 3D ビジュアライザ
- OpenUSDアセットをロードし、ロボット・人・設備の状態を3Dで描画。
- 差分スナップショットをWebSocket経由で受信し、リアルタイム更新。

### 2. シナリオエディタ
- YAML/JSONのシナリオをGUIで可視化・編集。
- 初期スナップショットやイベントスケジュールをタイムライン表示で管理。
- 保存したシナリオをWebSocket経由でSimulation Masterに送信。

### 3. ロジック編集（Behavior Tree Editor）
- SCXMLまたはBT XMLをGUI上で編集。
- ドラッグ＆ドロップでBTを構築し、SimPy/Gazebo用に変換して送信。

### 4. ログ・リプレイビューア
- 保存済みスナップショットをWebSocket経由でロードして再生。
- 再生速度調整、イベントフィルタリング、統計表示が可能。

---

## UIデザインの特徴
- **モジュール別のタブ切り替えUI**（3Dビュー、シナリオ、BT、ログ）。
- **ドラッグ＆ドロップでのアセット操作**。
- **リアルタイム性**を重視し、WebSocketでスナップショットを低遅延配信。
- **非エンジニアでも使いやすい操作性**を重視。

---

## データフロー

1. GUIでシナリオやBTを編集し、WebSocketでサーバーへ送信。
2. WebサーバーがZeroMQ経由でSimulation Masterに転送。
3. 実行中は、Simulation Masterからの差分スナップショットをWebSocket経由で受信し、3D表示を更新。
4. ログ再生時は、保存済みスナップショットをロードし、GUIで再生。

